using NicksVM.Core;

VirtualMachine vm = new();

byte[] bootRom =
[
  // ProgramOffset section prog(.org)
  0x00,0x00,0x00,0x00,
  // DataOffset section data(.org)
  0x0d,0x00,0x00,0x00,

  // SECTION .prog
  // ldcop A
  0x0D,0x01,
  
  // ldimm32 C, 0x0
  0x89,0x00,
  0x00,0x00,0x00,0x00,
  // ldimm8 AHL, 0x02
  0x90,0x00,
  0x02,

  // ldfcr AHL
  0x41,0x01,

  // SECTION .data
  // .ascii "ciao mondo\0"
  0x63,0x69,0x61,0x6F, 0x20, 0x6D,0x6F,0x6E,0x64,0x6F, 0x00,
];

vm.LoadROM(bootRom);
while (vm.idpu.Cycle()) ;

Console.WriteLine($"Program ended with code {vm.cpu.C:X}");